#!/bin/bash

# ============================================================================
# Script: query_disk_size.sh
# Description: 查询系统硬盘大小信息
# Author: Assistant
# Date: 2023-10-05
# Version: 1.0
# ============================================================================

# ----------------------------
# 函数: 打印错误信息
# ----------------------------
print_error() {
    echo "ERROR: $1" >&2
}

# ----------------------------
# 函数: 检查命令是否存在
# ----------------------------
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# ----------------------------
# 主函数: 查询硬盘大小
# ----------------------------
main() {
    # 检查是否具有足够的权限（读取磁盘信息通常不需要root，但确保工具可用）
    if ! command_exists lsblk; then
        print_error "命令 'lsblk' 未找到。请确保 util-linux 软件包已安装。"
        exit 1
    fi

    echo "正在查询硬盘大小信息..."
    echo "------------------------------------------------------------"

    # 使用 lsblk 获取磁盘信息（仅显示设备名和大小）
    # 过滤出 type 为 disk 的条目，避免显示分区
    if ! output=$(lsblk -d -o NAME,SIZE,MODEL 2>&1); then
        print_error "无法获取磁盘信息：$output"
        exit 1
    fi

    # 显示表头
    printf "%-20s %-15s %-30s\n" "设备名称" "大小" "型号"
    echo "------------------------------------------------------------"

    # 跳过标题行并输出数据
    echo "$output" | tail -n +2 | while read -r line; do
        printf "%s\n" "$line"
    done

    # 如果没有输出数据，提示用户
    if [ $(echo "$output" | wc -l) -le 1 ]; then
        echo "未发现任何磁盘设备。"
    fi

    echo "------------------------------------------------------------"
    echo "查询完成。"
}

# ----------------------------
# 脚本入口点
# ----------------------------
# 启用严格模式
set -euo pipefail

# 调用主函数
main "$@"

# 退出脚本，返回上一个命令的退出状态
exit $?